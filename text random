# Set the path to your IIS log file
$logFile = "C:\inetpub\logs\LogFiles\W3SVC1\u_ex250323.log"
$outputFile = "C:\inetpub\logs\LogFiles\W3SVC1\iis_log_converted.csv"

# Read the log file, skip comment lines, and convert to CSV
$lines = Get-Content $logFile | Where-Object { $_ -notmatch "^#" }
$fieldsLine = ($lines | Where-Object { $_ -match "^#Fields:" }) -replace "#Fields: ", ""
$fields = $fieldsLine -split " "
$dataLines = $lines | Where-Object { $_ -notmatch "^#" -and $_ -notmatch "^#Fields:" }

# Create CSV content
$csvContent = @()
$csvContent += ($fields -join ",")
foreach ($line in $dataLines) {
    $values = $line -split " "
    $csvLine = ($values -join ",")
    $csvContent += $csvLine
}

# Save to CSV
$csvContent | Out-File $outputFile
